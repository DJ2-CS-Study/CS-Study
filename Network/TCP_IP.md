

# TCP/IP

> TCP, IP는 컴퓨터들이 인터넷을 통해 정보를 주고받는 과정에서 사용하는 통신 규약(프로토콜)입니다.
> 인터넷 프로토콜 중 가장 많이 쓰이는 만큼 중요하고, 신입 개발자 면접의 단골 소재로 등장하기도 하니, 잘 짚고 넘어가는 것이 좋습니다.
>
> 그런데 처음 TCP, IP를 접하면 프로토콜이 뭔지, 통신 규약은 왜 필요한지부터 이해가 되지 않습니다. 그래서 다음과 같은 흐름으로 TCP/IP를 설명할 예정입니다.
> 
>
> 1. 인터넷 통신은 어떻게 이루어질까(+ IP는 왜 필요할까)
> 2. IP는 뭘까
> 3. TCP는 왜 필요할까
> 4. TCP는 뭘까



## 인터넷 통신은 어떻게 이루어질까

### 초미니 인터넷

내 방 안에 컴퓨터 두 대가 있다고 생각해봅시다. 하나는 클라이언트, 하나는 서버 역할을 합니다. 그리고 아래 과정을 거치면 초미니 인터넷이 완성됩니다.

1. 두 컴퓨터를 전선으로 잇는다.
2. 클라이언트에서 Hello, world!를 전송한다.
3. 서버에서 잘 받았다는 응답 OK를 전송한다.

|                     초미니 인터넷                     |
| :---------------------------------------------------: |
| <img src="TCP_IP.assets/internet1.png" width="700px"> |



### IP의 필요성

하지만 실제 인터넷은 두 대로만 이루어있지 않습니다. 전 세계의 컴퓨터 뿐 아니라 이들의 중간 다리 역할을 하는 온갖 서버들, 라우터들이 연결되어 있죠.

여기서 문제가 발생합니다. 내가 데이터를 보낼 컴퓨터(서버)를 어떻게 찾아갈까요? 편지를 보내려는데, 받을 사람의 주소를 모르는 것과 같은 상황입니다. 

|                   현실의 인터넷은..                    |
| :----------------------------------------------------: |
| <img src="TCP_IP.assets/internet2.png" width="1000px"> |



## IP(Internet Protocol)

### IP의 등장

이 문제를 해결하기 위해 사람들은 컴퓨터에 주소를 부여하기로 약속합니다. 주소를 알고 있으니, 원하는 컴퓨터와 데이터를 주고받을 수 있습니다.

IP의 등장입니다.

|                   IP 주소로 찾아가자                   |
| :----------------------------------------------------: |
| <img src="TCP_IP.assets/internet3.png" width="1000px"> |



### IP의 역할

IP의 역할은 다음과 같습니다.

- 지정한 IP 주소(IP Address)에 데이터 전달
- 패킷(Packet)이라는 통신 단위로 데이터 전달



### 패킷이란?

패킷은 통신 단위입니다. 전달할 데이터가 커지면, 여러 패킷에 나누어 담아 전달하기도 합니다.

다소 생소한 용어여서 무슨 의미가 있나 싶지만, 단순히 Package(수화물)와 Bucket(바구니)의 합성어입니다. '데이터를 담는 것' 정도의 의미를 주기 위해 대충 지은 이름이니 어렵게 생각하지 않아도 좋습니다.



### IP 패킷 정보

패킷에는 출발지 IP, 목적지 IP 정보가 기록됩니다. 전송하고자 하는 데이터가 패킷이라는 캡슐에 담겨 보내지는 것이죠.

|                      IP 패킷 정보                      |
| :----------------------------------------------------: |
| <img src="TCP_IP.assets/internet4.png" width="1000px"> |



### 클라이언트-서버 패킷 전달 과정

이제 데이터의 전달 과정을 보다 구체적으로 그려볼 수 있게 되었습니다.

1. 클라이언트는 출발지 IP, 목적지 IP가 기록된 패킷에 전송할 데이터(Hello, world!)를 담아 전송합니다.
2. 패킷에 기록된 목적지 IP로 패킷이 전달됩니다.

|                  클라이언트 패킷 전달                  |
| :----------------------------------------------------: |
| <img src="TCP_IP.assets/internet5.png" width="1000px"> |

서버측의 응답도 같은 방식으로 진행됩니다.

|                     서버 패킷 전달                     |
| :----------------------------------------------------: |
| <img src="TCP_IP.assets/internet6.png" width="1000px"> |



### IP의 한계

#### 비연결성

#### 비신뢰성

#### 프로그램 구분



## TCP

### TCP 3 way handshake

> 연결 성립 과정

<img src="TCP_IP.assets/3way.PNG" alt="3way" style="zoom:50%;" />

### TCP 4 way handshake

> 연결 해제 과정

<img src="TCP_IP.assets/4way.png" alt="4way" style="zoom: 67%;" />

1. 클라이언트가 연결을 종료하겠다는 **FIN 플래그**를 전송
2. 서버는 클라이언트의 요청(FIN)을 받고 알겠다는 확인 메세지로 **ACK**를 보낸다.
   1. 그리고 데이터를 모두 내보낼 때까지 잠깐 **TIME_OUT**이 된다.
3. 데이터를 모두 내보내고 통신이 끝났으면 연결이 종료되었다고 클라이언트에게 **FIN 플래그**를 전송한다.
4. 클라이언트는 FIN 메세지를 확인했다는 **메세지(ACK)**를 보낸다.
5. 클라이언트의 ACK 메세지를 받은 **서버는 소켓 연결을 close** 한다.
6. 클라이언트는 아직 서버로부터 받지 못한 데이터가 있을 것을 대비해 일정 시간 동안 세션을 남겨놓고 잉여 패킷을 기다리는 과정을 거친다.

### 흐름 제어

#### 어떤 문제를 해결할까?

> 송신측과 수신측의 데이터 처리 속도 차이를 해결하는 기술

- 수신측이 송신측보다 속도가 빠른 것은 문제가 되지 않는다. => 보내주는 만큼 다 받으면 되니까!
- 단, 송신측이 수신측보다 빠르면 문제가 발생한다.
  - 송신측에서 보내는 데이터 속도가 더 빠르다면 수신측에서 제한된 저장 용량을 초과하게 됨
  - 이 경우 이후에 도착하는 데이터의 손실 발생 가능 => 데이터 재전송 필요 => 비효율

#### 어떻게 해결할까?

##### 방법1: Stop & Wait

- 매번 전송한 패킷에 대해 확인 응답을 받아야만 그 다음 패킷을 전송

##### 방법2: Sliding Window

- 송신측, 수신측은 자신이 한 번에 얼마나 보낼 수 있고, 받을 수 있는지 끊임없이 확인한다.
  - 이렇게 자신이 한 번에 받고/보낼 수 있는 데이터 양을 TCP Header 내의 'Window size'에 기록
  - 아무래도 수신측의 사정이 더 중요하다보니 Window size는 수신자가 정한다.(3-way handshake에서)



1. 송신 버퍼
   - 200 이전의 바이트는 전송 완료
   - 200~201 바이트는 전송되었으나 확인 응답을 받지 못한 상태
   - 203~211 바이트는 아직 전송이 되지 않은 상태
   - 여기서 송신측은 몇 바이트까지 데이터를 보내도 될까?

![1](TCP_IP.assets/1.png)

2. 수신 윈도우
   - 200 이전의 바이트를 받은 상태

![2](TCP_IP.assets/2.png)

3. 송신 윈도우

   - 수신 윈도우가 7바이트니까 206까지 허락 안 받고 보내도 수신측이 받아낼 수 있다.

     ![3](TCP_IP.assets/3.png)

4. 송신 윈도우 이동
   - Before: 203~204 전송
   - After: 수신측에서 확인 응답 203을 보낸다. => 송신측은 이를 받아 수신 윈도우를 203~209로 이동

![4](TCP_IP.assets/4.png)

### 혼잡 제어

#### 어떤 문제를 해결할까?

> 데이터가 지나가는 네트워크 망이 혼잡해서 데이터를 제대로 보낼 수 없을 때 사용하는 방법

- 데이터를 주고받는 양 단말도 중요하지만, 데이터가 지나가는 네트워크망이 혼잡하다면 결국 오버플로우나 데이터 손실이 발생할 수 있다.

#### 어떻게 해결할까?

##### 방법1: Slow start

- 송신자는 연결 초기에 데이터 송출량을 낮게 잡고 보내면서 수신자의 수신을 확인하며 데이터 송출량을 조금씩 늘린다. 점차 주고받다보면 현재 네트워크에서 가장 적합한 데이터 송출량을 찾을 수 있게 됨.





## PORT



## DNS

