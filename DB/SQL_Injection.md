# SQL Injection (SQL 삽입 공격)

#### 1.1 SQL Injection ?

웹 사이트의 보안상 허점을 이용해 악의적인 특정 SQL 쿼리 문을 전송하여 데이터베이스를 비 정상적으로 조작하는 해킹 방법이다. 공격은 비교적 쉬운 편이나 성공 시 조직 내부의 민감한 정보나 개인 정보들을 획득 할 수 있어 큰 피해를 입을 수 있다.

<br>

#### 2. 공격 종류 및 방법

**2.1 인증 우회**

보통 아이디와 패스워드를 입력하는 로그인 페이지를 타겟으로 행해지는 공격이다. SQL 쿼리문의 true/false 논리적 연산 오류를 이용하여 로그인 인증 쿼리문이 id에 해당하는 특정 비밀번호가 아니더라도 무조건 ture의 결과값이 나오게 하여 인증을 무력화 시키는 원리이다. 

가장 대표적인 구문은 ID와 PASSWORD에 `or 1 = 1`을 입력하여 `SELECT * FROM Users WHERE id = 'INPUT1' AND password = 'INPUT2'`  의 where 구문을 true 값으로 만드는 것이다.

**2.2 데이터 노출**

시스템에서 발생하는 에러 메시지를 이용해 공격하는 방법이다. 보통 에러는 개발자가 버그를 수정하는 면에서 도움을 받을 수 있는 존재지만 해커들은 이를 역이용해 악의적인 구문을 삽입하여 에러를 유발시킨다. 

예를 들면, 해커는 GET 방식으로 동작하는 URL 쿼리 스트링을 추가하여 에러를 발생시킨다. 이에 해당하는 오류가 발생하면, 이를 통해 해당 웹 앱의 데이터베이스 구조를 유추할 수 있고 이를 해킹에 활용 할 수 있다.

`쿼리 스트링이란? url 주소에 미리 협의된 데이터를 파라미터를 통해 넘기는 것을 말한다. ? 으로 쿼리스트링의 시작을 알릴 수 있으며 url 주소 뒤에 입력 데이터를 제공하는 방식을 취한다`

<br>

#### 3. 대응 방안

##### 3.1 입력 값에 대한 검증

입력값을 검사하여 SQL Injection을 예방하는 방법이다. SQL Injection에 쓰이는 특수문자나, SQL 명령어들이 있는지 검사한다. 하지만 이 방법은 정교하게 입력값을 검사하지 않는다면 검증을 우회하는 방법들이 존재하므로 사용에 주의하여야 한다.

**3.2 Prepared State 구문 사용**

Prepared Satement란, 미리 쿼리에 대한 컴파일을 수행하고, 입력 값을 나중에 넣는 방식이다. 그렇게 함으로써 비 정상적인 입력값이 들어와도, 이미 서버 측에서 필터링 과정을 거치고 사용자의 입력 값은 단순 문자열로 인식하게 되어 공격 쿼리문이 들어가더라도 공격자의 의도대로 작동하지 않아 SQL Injection을 막을 수 있게 된다.

**3.3 Error Message 노출 금지**

공격자가 SQL Injection을 수행하기 위해서는 데이터베이스의 정보(테이블명, 컬럼명 등등)가 필요하다. 만약 데이터베이스 에러 발생 시 따로 처리 해 주지 않았다면, 에러가 발생한 쿼리문과 함께 에러에 관한 내용을 반환해 주게 되는데 이 때 테이블명 및 쿼리문 등이 노출 될 수 있기 때문에 이에 대한 오류 발생 시 사용자에게 보여줄 수 있는 페이지를 제작하거나 메시지 박스를 띄우도록 해야 한다.

**3.4 웹 방화벽 사용**

 웹 방화벽은 웹 공격 방어에 특화되어 있기 때문에 SQL Injection 방어에 큰 역할을 한다. 웹 방화벽은 소프트웨어 형, 하드웨어 형, 프록시 형 세가지 종류로 나뉘닌다. 소프트웨어 형은 서버 내에 직접 설치하는 방법이고, 하드웨어 형은 네트워크 상에서 서버 앞 단에 직접 하드웨어 장비로 구성하는 것 이고, 프록시 형은 DNS 서버 주소를 웹 방화벽으로 바꾸고 서버로 가는 트래픽이 웹 방화벽을 먼저 거치도록 하는 방법이다.

<br>

----

[참고1]: https://noirstar.tistory.com/264
[참고2]: https://gyoogle.dev/blog/computer-science/data-base/SQL%20Injection.html
[참고3]: https://m.blog.naver.com/lstarrlodyl/221837243294

