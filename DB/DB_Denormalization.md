# 반정규화(Denormalization)

> 역정규화라고도 하며 시스템의 성능 향상, 개발 및 운영의 편의성 등을 위해 정규화된 데이터 모델을 통합, 중복, 분리하는 과정으로, **의도적으로 정규화 원칙을 위배하는 행위**이다.

<br>

### 0. 반 정규화는 왜 쓰는걸까?

* 정규화 시 빈번한 Join이 필요하여 수행 속도가 느려진 경우
* 다량의 범위를 자주 처리해야 하는 경우
* 특정 범위의 데이터만 자주 처리하는 경우 등등 ...

<br>

> 정규화는 쓰기의 편리함을 위해 읽기의 성능을 희생하는 것과 같다. 릴레이션 간 데이터의 읽기를 할 경우에는 join을 사용하게 되는데 이는 성능을 많이 요구하는 편이다. 즉 정규화가 되어 join연산이 빈번하여 읽기의 성능을 너무 많이 요구할 때, 정규화된 표의 구조를 다시 바꾸어 읽기 성능 저하 문제를 해결할 수 있다. 역/반 정규화는 최후의 수단으로 쓰이며 데이터 무결성이 깨질 수 있는 위험을 무릅쓰고 성능 저하를 개선시키는 것이다. 
>
> 단, 반 정규화를 실행한다고 해서 정규화 되지 않은 데이터가 좋다는 것은 아니다. 

반정규화(데이터 무결성 위협) <->  정규화(성능의 이슈발생)

<br>

### 1. 반 정규화 유형 및 절차

반 정규화는 테이블, 속성, 관계에 대해 적용할 수 있으며 시스템 성능향상과 개발, 운영의 단순화를 위해 중복, 통합, 분리 등을 수행하는 것이다.

##### 1.1 반정규화 유형

| 유형                  | 설명                                                         |
| --------------------- | ------------------------------------------------------------ |
| Table Merge           | 부모 테이블에 자식 테이블의 속성을 삽입하고 자식 테이블 삭제 |
| Redundant Column 추가 | 조인하여 읽어올 속성을 양쪽 테이블에 중복적으로 저장         |
| Computed Column 추가  | 여러 숫자 필드를 조인하여 계산이 필요한 경우에 가장 조회수가 많은 속성을 지닌 테이블에 계산 결과 속성 추가 |
| Code Table Merge      | 코드명을 속성으로 추가하여 조인 제거                         |
| Table 수직분할        | 매우 많은 수의 컬럼으로 구성된 테이블에서 빈번하게 접근 되는 컬럼과 접근 횟수가 적은 컬럼을 분리하여 구성 |
| Table 수평분할        | 동일한 속성을 가진 테이블을 기준에 따라 2개로 분리           |

<br>

##### 1.2 반정규화 절차

| 절차                  | 방법                  | 설명                                                         |
| --------------------- | --------------------- | ------------------------------------------------------------ |
| 1) 반정규화 대상조사  | 범위처리 빈도수 조사  | 자주 사용되는 테이블에 접근하는 프로세스 수가 많고, 항상 일정한 범위만을 조회하는 경우 |
|                       | 대량 범위처리 조사    | 테이블에 대량의 데이터가 있고 대량의 데이터 범위를 자주 처리하는 경우 처리 범위를 일정하게 줄이지 않으면 성능 보장이 불가능한 경우 |
|                       | 통계 성 프로세스 조사 | 통계 성 프로세스에 의해 통계 정보를 필요로 할 때 별도의 통계테이블(반정규화 테이블)을 생성 |
|                       | 테이블 조인 개수 조사 | 테이블에 지나치게 많은 조인(JOIN)이 걸려 데이터를 조회하는 작업이 기술적으로 어려울 경우 반정규화를 검토 |
| 2) 다른 방법 유도검토 | 뷰 테이블             | 지나치게 많은 조인(JOIN)이 걸려 데이터를 조회하는 작업이 기술적으로 어려울 경우 뷰(VIEW)를 사용 |
|                       | 클러스터링 적용       | 대량의 데이터를 특정 클러스터링 팩트에 의해 저장방식을 다르게 하는 방법(조회중심의 테이블에만 적용가능) |
|                       | 인덱스 적용           | 인덱스를 통해 성능을 충분히 확보할 수 있다면 인덱스를 조정하여 반정규화를 회피 |
|                       | 응용 어플리케이션     | 응용 애플리케이션에서 로직을 구사하는 방법을 변경함으로써 성능을 향상 |
| 3) 반정규화 적용      |                       | 테이블/속성/관계 반정규화                                    |

<br>

##### 1.3 반정규화 방법

| 구분            | 방법                  | 설명                                                         |
| --------------- | --------------------- | ------------------------------------------------------------ |
| 테이블 반정규화 | 테이블 병합           | 조인되는 경우가 많아서 테이블을 합치는 것이 성능향상에 효율적일 경우에 적용<br />1:M 관계는 데이터 중복이 발생하므로 신중히 접근해야 함 |
|                 | 테이블 분할           | 분할된 테이블의 전체 조회 시 union을 사용해야 하므로 성능이 느려짐 |
|                 | 테이블 추가           | 논리적인 모델링이 끝난 후 추가적으로 통계 산출 발생 시 통계 테이블을 추가하여 테이블을 산출 |
| 컬럼 반정규화   | 중복 컬럼 추가        | 다른 테이블에 존재하는 속성 자주 이용 경우<br />확인하려는 정보가 너무 많은 조인으로 불필요한 낭비 발생 경우 |
|                 | 파생 컬럼 추가        | 연산을 통해서 결과값을 자주 접근하게 될 경우 컬럼을 추가해 연산을 단순화 |
|                 | 이력 테이블 컬럼 추가 | 시점 이력 테이블에 최신의 여부를 확인하기 위해 최신 날짜를 추가하는 경우 |
|                 | PK에 의한 컬럼 추가   | 여러 컬럼으로 이루어진 PK를 가진 테이블을 조인할 경우 단순성을 위해서 인공키를 PK로 지정하고 활용 |
|                 | 정리                  | 읽기 성능을 향상시키고 SQL 문장을 더 간단히 작성 가능<br />무결성 확보 어렵고 추가 저장공간 필요, 중복 속성 인해 원본 확인 어려움 |
| 관계 반정규화   |                       | 조회 관계를 단순화시키기 위해 관계를 중복                    |

